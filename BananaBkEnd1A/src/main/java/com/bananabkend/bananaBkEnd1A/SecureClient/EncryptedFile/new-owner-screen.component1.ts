import { Component, OnInit, Input,ViewChild,ElementRef } from '@angular/core'; import { FormBuilder, FormGroup, FormControl,FormArray } from '@angular/forms'; import { fqlmz6llqdService } from '../owner-services/y7xcsArbrB.service'; import { fqlmz6llqd } from '../owner-services/model/y7xcsArbrB'; import { UqbQVeAJbs } from '../owner-services/model/response-success'; import { f8ZbbO16lV } from '../owner-services/model/api-key-dto'; import { cnVZNbCsul } from '../../../../common/util/message-list'; import { UJxZ3xssJo } from '../owner-list-ad/model/my-ads-dto';  import { ActivatedRoute } from '@angular/router';  @Component({   selector: 'app-y7xcsArbrB',   templateUrl: './y7xcsArbrB.component.html',   styleUrls: ['./y7xcsArbrB.component.css'] })    export class fqlmz6llqdComponent implements OnInit {   6QRQbtxIzM: f8ZbbO16lV=new f8ZbbO16lV();   lsYzdZV6aD: UqbQVeAJbs;   mpMpj52Ibc: File   ceOPHP6qHq: any='assets/images/p300.jpg';   nSAnUlbAYj:string;   dkps0Sxbkb:string;   8selIzT8xL:number;   2bbt7dissV:number=0;;   bSJtmxmlq1: cnVZNbCsul= new cnVZNbCsul();   AtlbbbYkeT=false;   aYbT2btgl8=false;   Enbrvbakjt=false;   JZCMOlvt1s=false;   sTkxLbnGrb=false;   O8bD0Ulid7:boolean=true;   Pu5yHlKy83:boolean=false;   c5Kss87bAd:boolean=false;   cRruPsapcs:boolean=false;   YnouRFn8ix:string;   kbdIMUnXbb:UJxZ3xssJo;     @ViewChild('inputFileBrowse') inputFileBrowse: ElementRef<HTMLElement>;    constructor(csZrnPBcnu: f8ZbbO16lV, private formBuilder: FormBuilder,               private FsdnisvbUr : fqlmz6llqdService,               private route: ActivatedRoute ) {       this.8selIzT8xL=1000;       console.log("fqlmz6llqdComponent 6QRQbtxIzM: "+csZrnPBcnu.apikey);       this.6QRQbtxIzM=csZrnPBcnu;          }    uiXsMbqLnb:boolean =true;   xsaAdFLpEd:boolean =false;   // 0q8sWkbqpl:FormGroup= new FormGroup({   //   ownerPhone: new FormControl(''),   //   ownerEmail: new FormControl(''),   //   secretNumber: new FormControl(''),   //   inputFile01: new FormControl('')   // });   dllbUmwsfd: fqlmz6llqd= new fqlmz6llqd();   //0q8sWkbqpl1 = this.dllbUmwsfd.0q8sWkbqpl;   0q8sWkbqpl:FormGroup = this.dllbUmwsfd.0q8sWkbqpl;    ngOnInit(): void {     console.log("hitting this.6QRQbtxIzM > ",this.6QRQbtxIzM);     //console.log("hitting f8ZbbO16lV.apiKeyG > ",f8ZbbO16lV.apiKeyG);      //var apikey1:string;          if(this.6QRQbtxIzM.apikey == undefined){     console.log("this.6QRQbtxIzM.apikey is undeifned &&&&&&&&&&********** > ");}      this.route.params.subscribe(params => {       this.YnouRFn8ix=params.id;       //apikey1=params.apikey;       //this.dllbUmwsfd.0q8sWkbqpl.controls.apikey.setValue(params.apikey);       //this.6QRQbtxIzM.apikey=params.apikey;       //f8ZbbO16lV.apiKeyG=params.apikey;        console.log("this.YnouRFn8ix params.apikey :",params.apikey);          });      if(this.6QRQbtxIzM.apikey==undefined)     {               //this.getAPIKey();       this.FsdnisvbUr.callGetAPIKey();       console.log("ngOnInit() ");     }     if(this.YnouRFn8ix==undefined)     {       this.dllbUmwsfd.0q8sWkbqpl.controls.status.setValue('Y');       this.dllbUmwsfd.0q8sWkbqpl.controls.adDisplayType.setValue('1');       this.dllbUmwsfd.0q8sWkbqpl.controls.identify.setValue('phone');       }else     {       this.dllbUmwsfd.0q8sWkbqpl.controls.identify.setValue('phone');       this.cRruPsapcs=true;       this.loadMyAd();     }          // this.0q8sWkbqpl.setValidators(this.0q8sWkbqplValidate());     // this.0q8sWkbqpl.validator.name=this.0q8sWkbqplValidate;     // .0q8sWkbqpl.0q8sWkbqplValidate;     // this.dllbUmwsfd.0q8sWkbqpl = this.formBuilder.group({     //   inputFile01: [''],     //   ownerPhone: '',     //   ownerEmail: '',     //   secretNumber: ''           // });   }    // onUpload1()   // {   //   this.FsdnisvbUr.getAllEmployees()   //   .subscribe((employees: any[]) =>{   //           this.employees=employees   //   },   //   (error) => console.log(error));   // }   0q8sWkbqplValidatorSuccess():boolean {     // console.log("10q8sWkbqplValidatorSuccess called 1");    // this.dllbUmwsfd.0q8sWkbqpl.controls.ownerPhone.setErrors({minLength: true});     var isValid:boolean=true ;    //this.sTkxLbnGrb=true;   //  console.log("2identify.value=="+this.dllbUmwsfd.0q8sWkbqpl.controls.identify.value);    if(this.dllbUmwsfd.0q8sWkbqpl.controls.identify.value==''){     this.AtlbbbYkeT=true;     this.dllbUmwsfd.0q8sWkbqpl.controls.ownerPhone.setErrors({required: true});     isValid=false;    }     if(this.dllbUmwsfd.0q8sWkbqpl.controls.identify.value=='phone' &&          this.dllbUmwsfd.0q8sWkbqpl.controls.ownerPhone.value=='')       {         this.AtlbbbYkeT=true;         this.dllbUmwsfd.0q8sWkbqpl.controls.ownerPhone.setErrors({required: true});         isValid=false;         // console.log("identify.value==phone");       }       // console.log("3identify.value=="+this.dllbUmwsfd.0q8sWkbqpl.controls.identify.value);     if(this.dllbUmwsfd.0q8sWkbqpl.controls.identify.value=='email' &&          this.dllbUmwsfd.0q8sWkbqpl.controls.ownerEmail.value=='')       {         this.aYbT2btgl8=true;         this.dllbUmwsfd.0q8sWkbqpl.controls.ownerEmail.setErrors({required: true});         isValid=false;         // console.log("identify.value==email");       }             // console.log("4file.value=="+this.dllbUmwsfd.0q8sWkbqpl.controls.file.value);      if(this.dllbUmwsfd.0q8sWkbqpl.controls.file.value=="" && this.kbdIMUnXbb==undefined)       {         this.JZCMOlvt1s=true;         this.dllbUmwsfd.0q8sWkbqpl.controls.file.setErrors({required: true});         // console.log("file.value==''");         isValid=false;       }        // console.log("5adType.value=="+this.dllbUmwsfd.0q8sWkbqpl.controls.adType.value);       if(this.dllbUmwsfd.0q8sWkbqpl.controls.adType.value=="")       {         this.sTkxLbnGrb=true;         this.dllbUmwsfd.0q8sWkbqpl.controls.adType.setErrors({required: true});         // console.log("adType.value==''");         isValid=false;       }        // console.log("6secretNumber.value=="+this.dllbUmwsfd.0q8sWkbqpl.controls.secretNumber.value);       if(this.dllbUmwsfd.0q8sWkbqpl.controls.secretNumber.value=="")       {         this.Enbrvbakjt=true;         this.dllbUmwsfd.0q8sWkbqpl.controls.secretNumber.setErrors({required: true});         // console.log("secretNumber.value==''");         isValid=false;       }       // console.log("7Finally isValid: "+isValid);     //this.dllbUmwsfd.0q8sWkbqpl.get('ownerPhone').getError('required');     // this.dllbUmwsfd.0q8sWkbqpl.markAsDirty;     // this.dllbUmwsfd.0q8sWkbqpl.controls.ownerPhone.setErrors({required: true});     // this.dllbUmwsfd.0q8sWkbqpl.controls.ownerPhone.getError('required');     return isValid;   }    onSubmit(){     if(this.6QRQbtxIzM.apikey==undefined){       console.log("onSubmit after set: "+this.6QRQbtxIzM.apikey)       return;     }      if(this.kbdIMUnXbb==undefined){       this.onSubmitReal();     }else{       this.onModifyReal()     }   }    onSubmitReal() {     if(!this.0q8sWkbqplValidatorSuccess())     {return;}      const formData = new FormData();     //let filename1: string = "Dogs Screenshot.png";     // formData.set("ownerPhone",this.dllbUmwsfd.0q8sWkbqpl.controls.ownerPhone.value);     // formData.set("ownerEmail",this.dllbUmwsfd.0q8sWkbqpl.controls.ownerEmail.value);     // formData.set("secretNumber",this.dllbUmwsfd.0q8sWkbqpl.controls.secretNumber.value);     // formData.set("inputFile01",this.dllbUmwsfd.0q8sWkbqpl.controls.inputFile01.value);          formData.append('ownerPhone', this.dllbUmwsfd.0q8sWkbqpl.controls.ownerPhone.value);     formData.append('ownerEmail', this.dllbUmwsfd.0q8sWkbqpl.controls.ownerEmail.value);     formData.append('secretNumber', this.dllbUmwsfd.0q8sWkbqpl.controls.secretNumber.value);     formData.append('contentDesc', this.dllbUmwsfd.0q8sWkbqpl.controls.contentDesc.value);     formData.append('adType', this.dllbUmwsfd.0q8sWkbqpl.controls.adType.value);     formData.append('status', this.dllbUmwsfd.0q8sWkbqpl.controls.status.value);     formData.append('adDisplayType', this.dllbUmwsfd.0q8sWkbqpl.controls.adDisplayType.value);     formData.append('inputFile01', this.mpMpj52Ibc);      if(this.mpMpj52Ibc.type.indexOf("image/")!=0) {       this.dkps0Sxbkb=this.bSJtmxmlq1.httpCodes['406'];       return;     }     //console.log(formData);     // this.httpClient.post<any>(this.SERVER_URL, formData).subscribe(     //console.debug('<<<< submit adType >>>>..',this.dllbUmwsfd.0q8sWkbqpl.controls['adType'].value);     //console.debug('<<<< submit adType >>>>..',this.dllbUmwsfd.0q8sWkbqpl.get('adType').value);          //console.debug('<<<< submit formData ownerPhone >>>>..',formData.get("ownerPhone"));        this.FsdnisvbUr.uploadDataAndImage(formData)     .subscribe((lsYzdZV6aD: any) => {console.log('response is  res >> ',lsYzdZV6aD);                         this.xsaAdFLpEd = true;                         this.dkps0Sxbkb=lsYzdZV6aD.message;  },               (err) =>  {console.log('response is err.error >> ', err.error)                           console.log('response is err.status >> ', err.status);                           this.dkps0Sxbkb=this.bSJtmxmlq1.httpCodes[''+err.status];                           //this.dkps0Sxbkb=err.name+' '+err.status;                         }     );            }     onModifyReal() {     if(!this.0q8sWkbqplValidatorSuccess())     {return;}      const formData = new FormData();     //let filename1: string = "Dogs Screenshot.png";     // formData.set("ownerPhone",this.dllbUmwsfd.0q8sWkbqpl.controls.ownerPhone.value);     // formData.set("ownerEmail",this.dllbUmwsfd.0q8sWkbqpl.controls.ownerEmail.value);     // formData.set("secretNumber",this.dllbUmwsfd.0q8sWkbqpl.controls.secretNumber.value);     // formData.set("inputFile01",this.dllbUmwsfd.0q8sWkbqpl.controls.inputFile01.value);          formData.append('ownerPhone', this.dllbUmwsfd.0q8sWkbqpl.controls.ownerPhone.value);     formData.append('ownerEmail', this.dllbUmwsfd.0q8sWkbqpl.controls.ownerEmail.value);     formData.append('secretNumber', this.dllbUmwsfd.0q8sWkbqpl.controls.secretNumber.value);     formData.append('contentDesc', this.dllbUmwsfd.0q8sWkbqpl.controls.contentDesc.value);     formData.append('adType', this.dllbUmwsfd.0q8sWkbqpl.controls.adType.value);     formData.append('status', this.dllbUmwsfd.0q8sWkbqpl.controls.status.value);     formData.append('adDisplayType', this.dllbUmwsfd.0q8sWkbqpl.controls.adDisplayType.value);     formData.append('inputFile01', this.mpMpj52Ibc);      if(this.mpMpj52Ibc != undefined  && this.mpMpj52Ibc.type.indexOf("image/")!=0) {       this.dkps0Sxbkb=this.bSJtmxmlq1.httpCodes['406'];       return;     }     // this.httpClient.post<any>(this.SERVER_URL, formData).subscribe(     //console.debug('<<<< submit adType >>>>..',this.dllbUmwsfd.0q8sWkbqpl.controls['adType'].value);     //console.debug('<<<< submit adType >>>>..',this.dllbUmwsfd.0q8sWkbqpl.get('adType').value);          //console.debug('<<<< submit formData ownerPhone >>>>..',formData.get("ownerPhone"));          formData.append('id', this.kbdIMUnXbb.id+'');       this.FsdnisvbUr.modifyAd(formData)           .subscribe((lsYzdZV6aD: any) => {console.log('response is  res >> ',lsYzdZV6aD);                               this.xsaAdFLpEd = true;                               this.dkps0Sxbkb=lsYzdZV6aD.message;  },                     (err) =>  {console.log('response is err.error >> ', err.error)                                 console.log('response is err.status >> ', err.status);                                 this.dkps0Sxbkb=this.bSJtmxmlq1.httpCodes[''+err.status];                                 this.dkps0Sxbkb=err.name+' '+err.status;                               }           );   }    loadMyAd()   {           //this.awaitingAuthorizeMsg=this.msgs.getMsg('myAdsList_loading_plz');     const formData = new FormData();     formData.append('id',this.YnouRFn8ix);                 this.FsdnisvbUr.getAdWithId(formData)       .subscribe((kbdIMUnXbb: any) =>{               //this.authorizeDone = true;                             this.kbdIMUnXbb=kbdIMUnXbb;               this.dllbUmwsfd.0q8sWkbqpl.controls.contentDesc.setValue(this.kbdIMUnXbb.contentDesc);               this.dllbUmwsfd.0q8sWkbqpl.controls.adType.setValue(this.kbdIMUnXbb.adType+'');               this.dllbUmwsfd.0q8sWkbqpl.controls.adDisplayType.setValue(this.kbdIMUnXbb.adDisplayType+'');               this.dllbUmwsfd.0q8sWkbqpl.controls.status.setValue(this.kbdIMUnXbb.status);               this.chooseSampleViewDisplayType(this.kbdIMUnXbb.adDisplayType);               //console.log("hitting uploadedFileName>>> ",this.kbdIMUnXbb.uploadedFileName);               //this.dllbUmwsfd.0q8sWkbqpl.controls.file.setValue(this.kbdIMUnXbb.uploadedFileName);               this.sendGetReq(this.YnouRFn8ix);               //this.awaitingAuthorizeMsg='';               //this.populateAdsList();             },           (error) => {console.log(error);                       //this.awaitingAuthorizeMsg=this.bSJtmxmlq1.httpCodes[''+error.status];  //Translate i15n                       //this.awaitingAuthorizeMsg=error.name+' '+error.status;           }             );   }    // getAPIKey()   // {         //   //this.awaitingAuthorizeMsg=this.msgs.getMsg('myAdsList_loading_plz');   //   const formData = new FormData();    //   formData.append('id',"");   //     this.FsdnisvbUr.getApiKey(formData)   //     .subscribe((6QRQbtxIzM: f8ZbbO16lV) =>{   //             //this.authorizeDone = true;                 //             this.6QRQbtxIzM.apikey=6QRQbtxIzM.apikey;   //             console.log("hitting getAPIKey > ",this.6QRQbtxIzM.apikey);    //             //f8ZbbO16lV.apiKeyG=this.6QRQbtxIzM.apikey;   //             //console.log("hitting getAPIKey G > ",f8ZbbO16lV.apiKeyG);     //             this.dllbUmwsfd.0q8sWkbqpl.controls.apikey.setValue(this.6QRQbtxIzM.apikey);   //           },   //         (error) => {console.log(error);   //                 console.log("hitting getAPIKey > ",this.6QRQbtxIzM.apikey);    //                 //console.log("hitting getAPIKey G > ",f8ZbbO16lV.apiKeyG);   //                 //this.awaitingAuthorizeMsg=this.bSJtmxmlq1.httpCodes[''+error.status];  //Translate i15n                  //               }         //     );   // }   // onFileChanged(event) {   //   this.mpMpj52Ibc = event.target.files[0]   // }    onUpload() {     // upload code goes here     // const uploadData = new FormData();     // uploadData.append('myFile', this.mpMpj52Ibc, this.mpMpj52Ibc.name);     // this.http.post('my-backend.com/file-upload', uploadData)     //     .subscribe(event => {     //       console.log(event); // handle event here     //     });   }   file: string;    handleChange(files: FileList) {     if (files && files.length) {       this.file = files[0].name;     }   }      activatePhoneContent(){     this.uiXsMbqLnb=true;     this.0q8sWkbqpl.controls.ownerEmail.setValue('');   }    activateEmailContent(){     this.uiXsMbqLnb=false;     this.0q8sWkbqpl.controls.ownerPhone.setValue('');   }    onSubmit2(){     //console.log("Submit button is clicked");     //this.0q8sWkbqpl.controls.ownerPhone.setValue("1234523423");     //console.debug('<<<< submit hit1 >>>>..',this.0q8sWkbqpl.controls.ownerPhone.value);     //console.log('submit2 file >> ',this.mpMpj52Ibc);     console.log(">>> targets ",this.0q8sWkbqpl.controls.targets);     console.log(">>> targets value ",this.0q8sWkbqpl.controls.targets.value[0]);     console.log(">>> targets value ",this.0q8sWkbqpl.controls.targets.value[1]);     //console.log("onfileselect called ownerEmail",this.0q8sWkbqpl.get('ownerEmail').value);     //this.0q8sWkbqpl.controls.ownerEmail.setValue("dsfgsdf.nkk");   }    browseFile() {     let el: HTMLElement = this.inputFileBrowse.nativeElement;     el.click();   }    onFileSelect(event) {     console.log("onfileselect called");     if (event.target.files.length > 0) {       const file = event.target.files[0];       this.mpMpj52Ibc = file;       console.log("onfileselect called 1",this.0q8sWkbqpl.get('file'));       console.log("onfileselect called 2",this.0q8sWkbqpl.controls.file.value);       this.nSAnUlbAYj=this.0q8sWkbqpl.controls.file.value;       const reader = new FileReader();       reader.onload = e => this.ceOPHP6qHq = reader.result;        reader.readAsDataURL(file);       // this.0q8sWkbqpl.get('inputFile01').setValue(file.name);       //this.0q8sWkbqpl.get('inputFile01').get();     }     //console.log("onfileselect called done ",this.0q8sWkbqpl.get('ownerPhone').value);       }    onKeyCountChar(event: any) { // without type info     const eTarget = event.target;     const maxLength = eTarget.getAttribute("maxlength");     const currentLength = eTarget.value.length;     this.2bbt7dissV=eTarget.value.length;     if (currentLength >= maxLength) {         return ;     }     //console.log(`${maxLength - currentLength} chars left`);   }   chooseSampleViewDisplayType(i){    if(i=='1'){     this.showSampleView1();    }    if(i=='2'){     this.showSampleView2();    }    if(i=='3'){     this.showSampleView3();    }  }   showSampleView1(){     this.O8bD0Ulid7=true;     this.Pu5yHlKy83=false;     this.c5Kss87bAd=false;   }    showSampleView2(){     this.O8bD0Ulid7=false;     this.Pu5yHlKy83=true;     this.c5Kss87bAd=false;   }    showSampleView3(){     this.O8bD0Ulid7=false;     this.Pu5yHlKy83=false;     this.c5Kss87bAd=true;   }    createImageFromBlob(image: Blob) {     let reader = new FileReader();     reader.addEventListener("load", () => {       this.ceOPHP6qHq =reader.result;              }, false);      if (image) {         reader.readAsDataURL(image);     }   }    sendGetReq(id:string){       this.FsdnisvbUr.getRequestCreated(id).subscribe(data => {         this.createImageFromBlob(data);         console.log('sendGetReq success ',data);       }, error => {         console.log('sendGetReq error ',error);       });   } }